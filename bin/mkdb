#!/bin/bash


# Read MySQL database name
read -p "Enter database: " database;
# Read MySQL username
read -p "Enter username: " username;
# Read MySQL password
read -s -p "Enter password: " password;
echo;


if [ "$1" = "remake" ]; then
    read -p "Are you sure you want to delete and remake the database? (Y/y): " -r
    echo    #move to a new line
    if [[ $REPLY =~ ^[Yy]$ ]]
    then
        echo "> Droping and recreating database $database...";
        mysql -u $username -p$password --verbose -e "DROP DATABASE IF EXISTS $database; CREATE DATABASE $database" || exit 1;
        echo;
    else
        exit 0;
    fi
fi


function execute_sql_file()
{
    mysql -u $username -p$password --verbose $database < $1 || exit 1;
}

SOURCE="${BASH_SOURCE[0]}";
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )";
SQLDIR=$DIR"/../db/sql/";

if [ "$1" = "dummy-inserts" ]; then
    echo "> Inserting dummy rows...";
    execute_sql_file $SQLDIR"dummy-inserts.sql";

    exit 0;
fi

echo "> Executing SQL files...";

execute_sql_file $SQLDIR"create-tables.sql";

execute_sql_file $SQLDIR"create-procedures.sql";


exit 0;
